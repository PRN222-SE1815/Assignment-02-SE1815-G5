@page
@model Presentation.Areas.Student.Pages.MyCourses.IndexModel
@{
    ViewData["Title"] = "My Courses";
}

<section class="registration-page">
    <div class="registration-container">
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title"><i class="fas fa-book-open"></i> My Courses</h1>
                <p class="page-subtitle">View all courses you have registered for</p>
            </div>
            <div class="wallet-badge">
                <i class="fas fa-layer-group"></i>
                <span class="wallet-label">Total</span>
                <span class="wallet-amount">@Model.CoursesPage.TotalCount courses</span>
            </div>
        </div>

        <div class="filter-bar">
            <div class="filter-group">
                <label class="filter-label" for="semesterSelect">
                    <i class="fas fa-calendar-alt"></i> Semester
                </label>
                <form method="get" id="semesterForm">
                    <select name="semesterId" id="semesterSelect" class="filter-select"
                            onchange="document.getElementById('semesterForm').submit();">
                        <option value="">All Semesters</option>
                        @foreach (var sem in Model.CoursesPage.Semesters)
                        {
                            <option value="@sem.SemesterId"
                                    selected="@(sem.SemesterId == Model.SemesterId)">
                                @sem.SemesterCode — @sem.SemesterName @(sem.IsActive ? "(Active)" : "")
                            </option>
                        }
                    </select>
                </form>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i> @Model.ErrorMessage
            </div>
        }

        @if (Model.CoursesPage.Items.Count == 0)
        {
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Bạn chưa đăng ký học phần nào.</p>
            </div>
        }
        else
        {
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Course Code</th>
                            <th>Course Name</th>
                            <th>Section</th>
                            <th>Semester</th>
                            <th>Teacher</th>
                            <th class="text-center">Credits</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Enrolled At</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.CoursesPage.Items)
                        {
                            <tr>
                                <td><span class="badge badge-code">@item.CourseCode</span></td>
                                <td>@item.CourseName</td>
                                <td><span class="badge badge-section">@item.SectionCode</span></td>
                                <td>@item.SemesterCode</td>
                                <td>@item.TeacherName</td>
                                <td class="text-center">@item.Credits</td>
                                <td class="text-center">
                                    @{
                                        var statusClass = item.Status switch
                                        {
                                            "ENROLLED" => "status-enrolled",
                                            "PENDING_APPROVAL" => "status-pending",
                                            "REJECTED" => "status-rejected",
                                            "DROPPED" => "status-dropped",
                                            "WITHDRAWN" => "status-dropped",
                                            "COMPLETED" => "status-completed",
                                            "CANCELED" => "status-rejected",
                                            _ => "status-default"
                                        };
                                    }
                                    <span class="enrollment-status @statusClass">@item.Status.Replace("_", " ")</span>
                                </td>
                                <td class="text-center">@item.EnrolledAt.ToString("yyyy-MM-dd HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @if (Model.TotalPages > 1)
            {
                <div class="paging-bar">
                    @if (Model.PageNum > 1)
                    {
                        <a asp-page="Index"
                           asp-route-semesterId="@Model.SemesterId"
                           asp-route-pageNum="@(Model.PageNum - 1)"
                           class="paging-btn">
                            <i class="fas fa-chevron-left"></i> Prev
                        </a>
                    }
                    else
                    {
                        <span class="paging-btn paging-disabled"><i class="fas fa-chevron-left"></i> Prev</span>
                    }

                    <span class="paging-info">
                        Page @Model.PageNum of @Model.TotalPages
                    </span>

                    @if (Model.PageNum < Model.TotalPages)
                    {
                        <a asp-page="Index"
                           asp-route-semesterId="@Model.SemesterId"
                           asp-route-pageNum="@(Model.PageNum + 1)"
                           class="paging-btn">
                            Next <i class="fas fa-chevron-right"></i>
                        </a>
                    }
                    else
                    {
                        <span class="paging-btn paging-disabled">Next <i class="fas fa-chevron-right"></i></span>
                    }
                </div>
            }
        }
    </div>
</section>

@section Styles {
    <link rel="stylesheet" href="~/css/Student/CourseRegistration/Index.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/Student/MyCourses/Index.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
}
